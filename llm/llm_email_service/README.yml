# ü§ñ OTOBO LLM Auto-Reply Service

## 1. Descri√ß√£o

Este projeto √© um **servi√ßo SMTP aut√≥nomo (standalone)** escrito em Python, concebido para atuar como um processador de "auto-respostas inteligentes" para o sistema de tickets OTOBO.

O seu objetivo √© receber notifica√ß√µes de cria√ß√£o de tickets, processar o pedido do cliente atrav√©s de uma API de LLM (como o Ollama/Llama 3) e enviar uma sugest√£o de resolu√ß√£o autom√°tica enquanto o cliente aguarda por um humano.

Este servi√ßo √© totalmente **independente** do core do OTOBO, funcionando de forma ass√≠ncrona para n√£o bloquear o funcionamento do Helpdesk.

---

## 2. Arquitetura

O servi√ßo utiliza uma arquitetura **Produtor-Consumidor** baseada em `asyncio` para garantir estabilidade e prote√ß√£o do servidor de IA.

1.  **Rece√ß√£o (Produtor):**
    * O OTOBO (via Postfix) envia um email para o servi√ßo na porta `2525`.
    * O servi√ßo aceita o email e coloca-o numa **Fila de Espera** (`Queue`).
    * Se a fila estiver cheia (limite configur√°vel), o email √© **descartado** imediatamente para proteger o sistema de sobrecarga ("Load Shedding").

2.  **Processamento (Consumidor/Worker):**
    * Um ou mais **Workers** retiram pedidos da fila sequencialmente.
    * O script extrai metadados do corpo do email (Cliente, Contexto, Ticket ID).
    * O pedido √© enviado ao LLM.
    * Uma resposta formatada (bilingue PT/EN) √© enviada ao Cliente.
    * Uma c√≥pia da resposta √© enviada de volta ao OTOBO (como nota oculta) para registo no ticket.

3.  **Envio (Relay):**
    * Os emails de resposta s√£o entregues atrav√©s do relay institucional (`mailsrvc.up.pt`).

---

## 3. Funcionalidades Principais

* **Rate Limiting:** Configura√ß√£o de quantos pedidos o LLM processa em simult√¢neo (default: 1) para evitar *timeouts*.
* **Contexto Din√¢mico:** O OTOBO pode instruir o LLM sobre como agir dependendo da fila (ex: "√âs um especialista em Alojamento Web" vs "√âs um assistente geral").
* **Modo de Teste:** Permite redirecionar todas as respostas para um email de administrador, evitando envio acidental para clientes durante o desenvolvimento.
* **Layout Visual:** Emails formatados com separadores de alto contraste e emojis para destacar a sugest√£o autom√°tica.

---

## 4. Instala√ß√£o

Siga estes passos num servidor Linux (ex: Debian/Ubuntu).

### 4.1. Pr√©-requisitos

```bash
sudo apt update
sudo apt install python3 python3-venv
